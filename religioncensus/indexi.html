<!DOCTYPE html>
<html>
	
<head>
	
	<meta charset="utf-8">
	<title>The Top Six Religious Affiliations by State and D.C. per Capita in 1906 from the 1906 Census of Religious Bodies (Excluding Alaska and Hawaii)</title>

	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700|Merriweather|Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>

<style type="text/css">
	
	h1 {
font-family: 'Open Sans Condensed', sans-serif;		text-align: center;
		}
	h3, h4 {
		font-family: 'Open Sans Condensed', sans-serif;
		text-align: center;
		}
	svg.legend {
		position: fixed;
		right: 0;
	    outline: 2px solid black;
	    outline-offset: 5px;
	    margin: 0 auto;
	    
		}
			
	svg {
		margin: 0 auto;
		position: static;	}
	text {
		font-family: 'Oswald', sans-serif;
		font-size: 0.9em;
		}
		
</style>

</head>

<body>
	<div id=header>	<h1> The Top Six Religious Affiliations per Capita in each State/Territory in 1906</h1>
	<h3>By <a href="https://lauraneckstein.com">Laura N. Eckstein Mapping</a></h3>
	<h4>From pages <a href="https://www2.census.gov/prod2/decennial/documents/00190438p1ch1.pdf">55-57 of <em>Religious Bodies: 1906</em></a></h4><br></div>

	<div class=legend></div>
	
	<div id=svg></div>

<script type="text/javascript">

	var m = 10
    r = 100
    z = color
	var color = d3.scale.ordinal()
	    .range(["#312F2F", "#E26762","#ECAA38", "#117899", "#0D3C55", "#5CA793", "#A2B86C", "#E2171A", "#BCCCE0", "#BF98A0", "#A6D9F7", "#6b486b"]);
	// thanks to https://www.viget.com/articles/add-colors-to-your-palette-with-color-mixing 

	var arc = d3.svg.arc()
	    .outerRadius(r)
	    .innerRadius(r - 30);

	var pie = d3.layout.pie()
	    .sort(null)
	    .value(function(d) { return d.population; });
	
	//Get Data
	d3.csv("data1.csv", function(error, data) {
	  if (error) throw error;
	  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "State"; }));

	data.forEach(function(d) {
	    d.religion = color.domain().map(function(name) {
	    return {name: name, population: +d[name]};
	    });
	  });

	var legend = d3.select("body").append("svg")
      .attr("class", "legend")
      .attr("width", r * 2)
      .attr("height", r * 4)
	  .selectAll("g")
	  .data(color.domain().slice().reverse())
	  .enter().append("g")
	  .attr("transform", function(d, i) { return "translate(0," + i * 25 + ")"; });

	legend.append("rect")
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);
   

	legend.append("text")
      .attr("x", 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .text(function(d) { return d; });
      
    //Add SVG Canvas 
	var svg = d3.select("body").selectAll("svg")
    .data(data)
  .enter().append("svg")
    .attr("width", (r + m) * 2)
    .attr("height", (r + m) * 2)
  .append("g")
    .attr("transform", "translate(" + (r + m) + "," + (r + m) + ")");

	  svg.selectAll(".arc")
      .data(function(d) { return pie(d.religion); })
	  .enter().append("path")
      .attr("class", "arc")
      .attr("d", arc)
      .style("fill", function(d) { return color(d.data.name); });
      
      

	svg.append("text")
      .attr("dy", ".35em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.State; });

});

</script>
    
</body>

</html>